# PC -> Master

## 資料格式

- 有限角伺服機手臂數值

  [SERVO_HEADER] [RegAdd] [Data] [SERVO_ENDING]

  

- 伺服機通道致能

  [SERVO_EN_HEADER] [RegAdd] [Data] [SERVO_EN_ENDING]

 - 伺服機通道禁能

   - 輪子

     [SERVO_WHEEL_DISEN_HEADER] [RegAdd] [Data] [SERVO_WHEEL_DISEN_ENDING]

   - 手臂

     [SERVO_ARM_DISEN_HEADER] [RegAdd] [Data] [SERVO_ARM_DISEN_ENDING]

     

- 無限轉伺服機移動方向

  [MOVEMENT_HEADER] [Data] [MOVEMENT_ENDING]



## 資料內容

| Title  | 資料大小 |     說明      |
| :----: | :------: | :-----------: |
| Header | uint8_t  | 標頭 [如下表] |
| RegAdd | uint8_t  |    PWM通道    |
|  Data  | uint8_t  |     資料      |
|  End   | uint8_t  | 標尾 [如下表] |



## 標頭標尾

|         標頭名稱         | 格式 [hex] |         標尾名稱         | 格式 [hex] |         說明         |
| :----------------------: | :--------: | :----------------------: | :--------: | :------------------: |
|       SERVO_HEADER       |     F0     |       SERVO_ENDING       |     F0     | 有限角伺服機手臂數值 |
|     SERVO_EN_HEADER      |     F1     |     SERVO_EN_ENDING      |     F1     |    伺服機通道致能    |
|     MOVEMENT_HEADER      |     F2     |     MOVEMENT_ENDING      |     F2     | 無限轉伺服機移動方向 |
| SERVO_WHEEL_DISEN_HEADER |     F5     | SERVO_WHEEL_DISEN_ENDING |     F5     |     輪子通道禁能     |
|  SERVO_ARM_DISEN_HEADER  |     F6     |  SERVO_ARM_DISEN_ENDING  |     F6     |     手臂通道禁能     |



## 角度轉換表

| 角度 [deg] | 數值 [dec] | 數值 [hex] |
| :--------: | :--------: | :--------: |
|    -90     |     38     |     26     |
|    -75     |     53     |     35     |
|    -60     |     68     |     44     |
|    -45     |     83     |     53     |
|    -30     |     98     |     62     |
|    -15     |    113     |     71     |
|     0      |    128     |     80     |
|     15     |    143     |     8F     |
|     30     |    158     |     9E     |
|     45     |    173     |     AD     |
|     60     |    188     |     BC     |
|     75     |    203     |     CB     |
|     90     |    218     |     DA     |



## 測試範例

|       名稱        | 範例 [hex]  |         意義          |
| :---------------: | :---------: | :-------------------: |
|       SERVO       | F0 00 80 F0 | 設定PWM 通道一 數值0  |
|     SERVO_EN      | F1 01 01 F1 |  設定PWM 通道一 致能  |
|     MOVEMENT      |  F2 57 F2   |        W 前進         |
| SERVO_WHEEL_DISEN |  F5 00 F5   | 設定 PWM 輪子通道禁能 |
|  SERVO_ARM_DISEN  |  F6 00 F6   | 設定 PWM 手臂通道禁能 |

# Master -> PC

## 資料格式

- 感應器

  [SENSOR_HEADER] [Data] [SENSOR_ENDING]



## 資料內容

| Title  | 資料大小 |     說明      |
| :----: | :------: | :-----------: |
| Header | uint8_t  | 標頭 [如下表] |
|  Data  | uint8_t  |     資料      |
|  End   | uint8_t  | 標尾 [如下表] |



## 標頭標尾

|   標頭名稱    | 格式 [hex] |   標尾名稱    | 格式 [hex] |  說明  |
| :-----------: | :--------: | :-----------: | :--------: | :----: |
| SENSOR_HEADER |     F3     | SENSOR_ENDING |     F4     | 感應器 |



## 感應器資料

### 資料範圍

0/1 感測資料 - 0(無) / 1(有)

### 資料

| 資料位置 [bit] | 擺放位置 | 說明 |
| :------------: | :------: | :--: |
|       15       |    空    |  空  |
|       14       |  右後側  | 朝地 |
|       13       |  右後側  | 朝右 |
|       12       |  右後側  | 朝後 |
|       11       |  左後側  | 朝地 |
|       10       |  左後側  | 朝左 |
|       9        |  左後側  | 朝後 |
|       8        |  右前側  | 朝地 |
|       7        |  右前側  | 朝右 |
|       6        |  右前側  | 朝前 |
|       5        |    空    |  空  |
|       4        |   手臂   | 朝前 |
|       3        |    空    |  空  |
|       2        |  左前側  | 朝地 |
|       1        |  左前側  | 朝左 |
|       0        |  左前側  | 朝前 |

## 測試範例

|  名稱  | 範例 [hex]  |             意義             |
| :----: | :---------: | :--------------------------: |
| SENSOR | F3 7F FF F4 | 感應器1~15皆近距離感測到物體 |

# Master -> Slave

## 資料格式

[Header] [RegAdd] [Total_Bytes] [Single_Bytes] [Data_1] ... [Data_Bytes] [Ending]



## 資料內容

|    Title     |      資料大小      |        說明         |
| :----------: | :----------------: | :-----------------: |
|    Header    |      uint8_t       |        標頭         |
|    RegAdd    |      uint8_t       | 暫存器編號 [如下表] |
| Total_Bytes  |      uint8_t       |     總資料大小      |
| Single_Bytes |      uint8_t       |    單筆資料大小     |
|     Data     | uint8_t / uint16_t |      資料陣列       |
|     End      |      uint8_t       |        標尾         |



## 標頭標尾

|     名稱      | 格式 [hex] |
| :-----------: | :--------: |
| 標頭 [Header] |     AA     |
| 標尾 [Ending] |     AA     |



## 暫存器編號

| RegAdd | 總資料大小 [Bytes] | 單筆資料大小 [Bytes] |         說明          |
| :----: | :----------------: | :------------------: | :-------------------: |
|   01   |         22         |          2           |     輸出PWM暫存器     |
|   02   |         22         |          2           |  輸出PWM下極限暫存器  |
|   03   |         22         |          2           |  輸出PWM上極限暫存器  |
|   04   |         2          |          2           |   輸出PWM通道禁致能   |
|   05   |         1          |          1           |   輸出PWM總電源開關   |
|   06   |         2          |          2           | 輸出PWM過電保護禁致能 |
|   07   |         1          |          1           |  清除接收暫存區資料   |
|   10   |         2          |          2           |  輸出PWM通道01暫存器  |
| 10 + n |         2          |          2           |  輸出PWM通道n暫存器   |
|   21   |         2          |          2           |  輸出PWM通道11暫存器  |



## PWM數值

- 數值範圍
  - 上極限 - 2.15 [ms]
  - 下極限 - 0.84 [ms]

- 順時針轉為正方向

| PWM [ms] | PWM Tick [dec] | PWM Tick [hex] | Degree [deg] |
| :------: | :------------: | :------------: | :----------: |
| 0.925975 |       90       |     00 5A      |     -90      |
| 1.480875 |      205       |     00 CD      |      0       |
| 2.035125 |      320       |     01 40      |      90      |



## 測試範例

|        說明        | RegAdd | 範例 [hex]                 | 意義                         |
| :----------------: | :----: | :------------------------- | ---------------------------- |
|  多通道PWM暫存器   |   01   | AA 01 16 02 [00 CD] *11 AA | 設定PWM 11通道輸出數值205    |
|    下極限暫存器    |   02   | AA 02 16 02 [00 48] *11 AA | 設定PWM 11通道下極限數值 72  |
|    上極限暫存器    |   03   | AA 03 16 02 [01 52] *11 AA | 設定PWM 11通道上極限數值 338 |
|     通道禁致能     |   04   | AA 04 02 02 07 FF AA       | 設定PWM 11通道致能           |
|     總電源開關     |   05   | AA 05 01 01 01 AA          | 設定PWM 總電源開關致能       |
|   過電保護禁致能   |   06   | AA 06 02 02 07 FF AA       | 設定PWM 11通道過電保護致能   |
| 清除接收暫存區資料 |   07   | AA 07 01 01 01 AA          | 清除接收暫存區資料           |
|  單通道PWM暫存器   | 10~21  | AA 0A 02 02 00 CD AA       | 設定PWM 1通道輸出數值205     |



## 快速貼上測試範例

|        說明         | 範例 [hex]                                             |
| :-----------------: | ------------------------------------------------------ |
|     總電源開啟      | AA05010101AA                                           |
|     11通道制能      | AA04020207FFAA                                         |
| 多通道PWM暫存器附值 | AA01160200CD00CD00CD00CD00CD00CD00CD00CD00CD00CD00CDAA |
| 單通道PWM暫存器附值 | AA0A020200CDAA                                         |

